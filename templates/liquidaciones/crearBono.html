<div class="widget-box">
  <div class="widget-header">
    <h4>Crear Bono</h4>
  </div>
  <div class="widget-body">
    <div class="widget-main no-padding">
      <form class="form-horizontal" enctype="multipart/form-data" method="POST" name="principal2" id="principal2" action="?do=liquidaciones.procesarBono" role="form" novalidate>
        <!-- <legend>Form</legend> -->
        
        <fieldset>
          <div class="row">
            <div class="col-sm-10 col-sm-offset-1">
              <div class="widget-box transparent invoice-box">
                <div class="widget-header widget-header-large">
                  <h3 class="grey lighter pull-left position-relative"> <i class="ace-icon fa fa-pencil green"></i> Liquidacion de Bonos </h3>
                </div>
                <div class="widget-body">
                  <div class="widget-main padding-24">
                    <div class="row">
                      <div class="col-sm-12">
                        <div class="row">
                          <div class="form-group">
                            <label for="factura" class="col-sm-3 control-label no-padding-right">Factura</label>
                            <div class="col-sm-9">
                              <div class="clearfix">
                                <input class="col-sm-12 col-xs-12" name="factura" type="text" id="factura" placeholder="Factura" value="{factura}">
                              </div>
                            </div>
                          </div>
                          <div class="form-group">
                            <label for="compania" class="col-sm-3 control-label no-padding-right"> Moneda </label>
                            <div class="col-sm-9">
                              <select class="form-control" id="moneda" name="moneda">
                                
                                {monedas}
                                
                              </select>
                            </div>
                          </div>
                          <div class="form-group">
                            <label for="compania" class="col-sm-3 control-label no-padding-right"> Compa√±ia </label>
                            <div class="col-sm-9">
                              <select class="form-control" id="compania" name="compania">
                                
                                {companias}
                                
                              </select>
                            </div>
                          </div>
                          <div class="form-group">
                            <label for="fecha" class="col-sm-3 control-label no-padding-right">Fecha</label>
                            <div class="col-sm-9">
                              <div class="clearfix">
                                <input value="{fechaFactura}" class="col-sm-12 col-xs-12 date-picker" name="fecha" type="text" id="fecha" data-date-format="dd/mm/yyyy">
                              </div>
                            </div>
                          </div>
                        </div>
                        <hr/>
                      </div>
                    </div>
                    <div>
                      <table class="table table-striped table-bordered">
                        <thead>
                          <tr>
                            <th>#</th>
                            <th class="col-sm-10 col-xs-10">Concepto</th>
                            <th>Monto</th>
                          </tr>
                        </thead>
                        <tbody id="comisionesFinal">
                          <tr>
                            <td>1</td>
                            <td><input class="col-sm-12 col-xs-12 " name="obser" type="text" id="obser" value="{obser}"></td>
                            <td><input name="subTotal" type="text" class="input-sm" id="subTotal" value="{subTotal}"></td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                    <div class="hr hr8 hr-double hr-dotted">
                    </div>
                    <div class="row">
                      <div class="col-sm-5 pull-right">
                        <h5 class="pull-right"> IGV :
                          <input name="igv" type="text" class="input-sm" id="igv" value="{igv}">
                        </h5>
                      </div>
                      <div class="col-sm-7 pull-left">
                        &nbsp;
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-sm-5 pull-right">
                        <h4 class="pull-right"> Total Factura :
                          <input name="totalFac" type="text" class="input-sm" id="totalFac" value="{totalFac}">
						  <input type="hidden" name="idLiquidacion" value="{idLiquidacion}" id="idLiquidacion">
                        </h4>
                      </div>
                      <div class="col-sm-7 pull-left">
                        &nbsp;
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </fieldset>
        <div class="form-actions center">
          <button class="btn btn-sm btn-success" type="button" id="terminar" style="display: inline-block;"> <i class="ace-icon fa fa-arrow-right fa-on-right bigger-110"></i> Guardar </button>
          <button class="btn btn-sm btn-light disabled " type="button" id="loading" style="display: inline-block;"> <img src="assets/img/loading.gif"/> Validando... </button>
        </div>
      </form>
    </div>
  </div>
</div>
<script>
  $('#loading').hide();
	$('#principal2').validate({
		errorElement: 'div',
		errorClass: 'help-block',
		onfocusout: false,
		focusInvalid: false,
		rules: {
			factura: {
				required: true,
			},
			fecha: {
				required: true,
				remote: {
					url: "?do=contabilidad.revisarMes",
					type: "post",
          beforeSend: function(e){
            $('#loading').show();
            $('#terminar').hide();
          },
          complete: function(e, valid){
            $('#loading').hide();
            $('#terminar').show();
          },
					data: {
						mes: function() {
						  var d =  $( "#fecha" ).val().split("/");
							return d["1"];
						},
						anio: function() {
						  var d =  $( "#fecha" ).val().split("/");
							return d["2"];
						}
					}
				}
			},
		},

		messages: {
			factura: {
				required: "Ingrese el Numero de Factura",
			},
			fecha: {
				required: "Ingrese la fecha de la factura",
				remote: "El mes se encuentra cerrado",
			},
		},

		invalidHandler: function (event, validator) { //display error alert on form submit   
			$('.alert-danger', $('.login-form')).show();
		},

		highlight: function (e) {
			$(e).closest('.form-group').removeClass('has-info').addClass('has-error');
		},

		success: function (e) {
			$(e).closest('.form-group').removeClass('has-error').addClass('has-info');
			$(e).remove();
		},
		
		errorPlacement: function (error, element) {
			if(element.is(':checkbox') || element.is(':radio')) {
				var controls = element.closest('div[class*="col-"]');
				if(controls.find(':checkbox,:radio').length > 1) controls.append(error);
				else error.insertAfter(element.nextAll('.lbl:eq(0)').eq(0));
			}
			else if(element.is('.select2')) {
				error.insertAfter(element.siblings('[class*="select2-container"]:eq(0)'));
			}
			else if(element.is('.chosen-select')) {
				error.insertAfter(element.siblings('[class*="chosen-container"]:eq(0)'));
			}
			else error.insertAfter(element.parent());
		},
	});

$('#fecha').mask("99/99/9999");
$('#fecha').datepicker({
  autoclose:true,
});

$(document).on('change', '#fecha', function() {
  //$(this).closest('.form-group').removeClass('has-error');
  //$(this).closest('.help-block').hide();
  $("#principal2").validate().element("#fecha");
});

	
			
$("#terminar").click(function() {
	$('select').removeAttr('disabled');	 
	$("#principal2").submit();
});

$('#subTotal').keyup(function(){
	var temp19 = parseFloat($( this ).val());
	$('#igv').val((temp19 * 0.18).toFixed(2));
	$('#totalFac').val((temp19 * 1.18).toFixed(2));
});

</script>