<div id="dialogoEndosos">
</div>
<h3 class="header smaller lighter blue" style="margin-top:0px;">Endosos
  <div class="btn-group pull-right">
    <button class="btn btn-xs btn-primary" id="botonAgregarEndoso">
      <i class="icon-plus-sign bigger-120"></i>&nbsp;&nbsp;Agregar Endoso
    </button>
  </div>
</h3>
  <block start="bloqueResultados"/>
<div class="table-responsive" style="margin-top:10px;">
  <table id="sample-table-2" class="table table-striped table-bordered table-hover">
    <thead>
      <tr>
        <th align="center">ID</th>
        <th align="center">Documento</th>
        <th align="center">Aviso de Cobranza</th>
        <th align="center">Prima Neta</th>
        <th align="center">Comision</th>
        <th align="center">Estado</th>
        <th align="center">Detalles</th>
      </tr>
    </thead>
    <tbody>
      <loop start="endosos"/>
      <tr>
        <td align="center">{endosos.idLista}</td>
        <td align="center">{endosos.documento}</td>
        <td align="center">{endosos.avisoCobranza}</td>
        <td align="center">{endosos.primaNeta}</td>
        <td align="center">{endosos.comision}</td>
        <td align="center">{endosos.estadoCobranza}</td>
        <td align="center"><div class="action-buttons">
            <a class="blue abreLink" x-tittle="Ver Endoso" x-link="?do=polizas.verEndoso&idEndoso={endosos.idEndoso}" href="#"> <i class="icon-money bigger-130"></i> </a> <a class="blue abreLink" x-tittle="Editar Endoso" x-link="?do=polizas.crearEndoso&idEndoso={endosos.idEndoso}&idPoliza={idPoliza}" href="#"> <i class="icon-edit bigger-130"></i> </a> <a class="blue eliminarEndoso" x-link="?do=polizas.eliminarEndoso&idEndoso={endosos.idEndoso}" href="#" {endosos.verEliminar}> <i class="icon-trash bigger-130"></i> </a>
          </td>
      </tr>
      <loop end="endosos"/>
    </tbody>
  </table>
  </div>
  <block end="bloqueResultados"/>
  <block start="bloqueNoResultados"/>
  
  <p> No se encontraron endosos en la Poliza. </p>
  <block end="bloqueNoResultados"/>
  
  <div id="dialog-message-endosos">
    <div class="alert alert-info bigger-110">
      El endoso se eliminara permanentemente, no sera posible recuperarlo.
    </div>
    <div class="space-6">
    </div>
    <p class="bigger-110 bolder center grey"> <i class="icon-hand-right blue bigger-120"></i> ¿Esta seguro? </p>
  </div>
</div>
<script>
$.widget("ui.dialog", $.extend({}, $.ui.dialog.prototype, {
	_title: function(title) {
		if (!this.options.title ) {
			title.html("&#160;");
		} else {
			title.html(this.options.title);
		}
	}
}));
$( "#dialogoEndosos" ).dialog({
	resizable: false,
	modal: true,
	title_html: true,
	autoOpen: false,
	maxWidth: 680,
	width: 680,
});

$( "#botonAgregarEndoso" ).click(function(){
		$("#dialogoEndosos").html('<div id="progressbar" class="ui-progressbar ui-widget ui-widget-content ui-corner-all progress progress-striped active" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="37"><div class="ui-progressbar-value ui-widget-header ui-corner-left progress-bar progress-bar-success" style="width: 100%;"></div></div>');
	$.ajax({
		url: '/?do=polizas.crearEndoso&idPoliza={idPoliza}',
		success: function(responseText){
			$('#dialogoEndosos').html(responseText);
			$('#dialogoEndosos').dialog('option', 'title', "<div class='widget-header'><h4 class='smaller'><i class='icon-plus-sign blue'></i> Crear Endoso</h4></div>");
			$('#dialogoEndosos').dialog("open");
		},
		error: function(responseText){
		}
	});
	event.preventDefault();
});

$('.eliminarEndoso').click( function() {
	event.preventDefault();
	$( "#dialog-message-endosos" ).data('link', $(this).attr("x-link")).dialog("open");
});	
$( "#dialog-message-endosos" ).dialog({
	resizable: false,
	modal: true,
	title_html: true,
	title: "<div class='widget-header'><h4 class='smaller'><i class='icon-warning-sign red'></i>¿Desea eliminar el Vehiculo?</h4></div>",
	autoOpen: false,
	buttons: [
		{
			html: "<i class='icon-trash bigger-110'></i>&nbsp; Eliminar",
			"class" : "btn btn-danger btn-xs",
			click: function() {
				$.ajax({
					type: "POST",
					dataType: "json",
					url: $(this).data('link'),
					success: function() {
						$("#tab-5").html('<div id="progressbar" class="ui-progressbar ui-widget ui-widget-content ui-corner-all progress progress-striped active" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="37"><div class="ui-progressbar-value ui-widget-header ui-corner-left progress-bar progress-bar-success" style="width: 100%;"></div></div>');
						$("#tab-5").load('/?do=polizas.verEndosos&idPoliza={idPoliza}');
					}
				});
				$( this ).dialog( "close" );
			}
		}
		,
		{
			html: "<i class='icon-remove bigger-110'></i>&nbsp;Cancelar",
			"class" : "btn btn-xs",
			click: function() {
				$( this ).dialog( "close" );
			}
		}
	]			
});	

$('.abreLink').click( function() {
	//verVehiculo					
	$('#dialogoEndosos').dialog('option', 'title', "<div class='widget-header'><h4 class='smaller'><i class='icon-dashboard blue'></i>" + $(this).attr('x-tittle') + "</h4></div>");
	$.ajax({
		url: $(this).attr('x-link'),
		success: function(responseText){
			$('#dialogoEndosos').html(responseText);
			$('#dialogoEndosos').dialog("open");
		},
		error: function(responseText){
		}
	});
	event.preventDefault();
});	
</script>