<div id="dialogoEndosos">
</div>
<h3 class="header smaller lighter blue" style="margin-top:0px;">Endosos
  <div class="btn-group pull-right">
    <button class="btn btn-xs btn-primary" id="botonAgregarEndoso">
      <i class="ace-icon fa fa-plus-circle bigger-120"></i>&nbsp;&nbsp;Agregar Endoso
    </button>
  </div>
</h3>
  <block start="bloqueResultados"/>
<div class="table-responsive" style="margin-top:10px;">
  <table id="sample-table-2" class="table table-striped table-bordered table-hover">
    <thead>
      <tr>
        <th align="center">ID</th>
        <th align="center">Documento</th>
        <th align="center">Aviso de Cobranza</th>
        <th align="center">Prima Neta</th>
        <th align="center">Comision</th>
        <th align="center">Estado</th>
        <th align="center">Detalles</th>
      </tr>
    </thead>
    <tbody>
      <loop start="endosos"/>
      <tr>
        <td align="center">{endosos.idLista}</td>
        <td align="center">{endosos.documento}</td>
        <td align="center">{endosos.avisoCobranza}</td>
        <td align="center">{endosos.primaNeta}</td>
        <td align="center">{endosos.comision}</td>
        <td align="center">{endosos.estadoCobranza}</td>
        <td align="center"><div class="action-buttons">
            <a class="blue abreLink" x-tittle="Ver Endoso" x-link="?do=polizas.verEndoso&idEndoso={endosos.idEndoso}" href="#"> <i class="ace-icon fa fa-money bigger-130"></i> </a>
            {endosos.anula}
            <a class="blue abreLink" x-tittle="Editar Endoso" x-link="?do=polizas.crearEndoso&idEndoso={endosos.idEndoso}&idPoliza={idPoliza}" href="#"> <i class="ace-icon fa fa-edit bigger-130"></i> </a>
            <a class="blue eliminarEndoso" x-link="?do=polizas.eliminarEndoso&idEndoso={endosos.idEndoso}" href="#" {endosos.verEliminar}> <i class="ace-icon fa fa-trash bigger-130"></i> </a>
          </td>
      </tr>
      <loop end="endosos"/>
    </tbody>
  </table>
  </div>
  <block end="bloqueResultados"/>
  <block start="bloqueNoResultados"/>
  
  <p> No se encontraron endosos en la Poliza. </p>
  <block end="bloqueNoResultados"/>

  <div id="dialog-message-endosos">
    <div class="alert alert-info bigger-110">
      El endoso se eliminara permanentemente, no sera posible recuperarlo.
    </div>
    <div class="space-6">
    </div>
    <p class="bigger-110 bolder center grey"> <i class="ace-icon fa fa-hand-right blue bigger-120"></i> ¿Esta seguro? </p>
  </div>
</div>
<div id="dialog-eliminarPDFendoso" class="hide">
	<div class="alert alert-info bigger-110">
		El archivo se eliminara permanentemente.
	</div>
	<div class="space-6"></div>
	<p class="bigger-110 bolder center grey">
		<i class="ace-icon fa fa-hand-o-right blue bigger-120"></i>
		¿Esta seguro?
	</p>
</div>
<script>
$.widget("ui.dialog", $.extend({}, $.ui.dialog.prototype, {
	_title: function(title) {
		if (!this.options.title ) {
			title.html("&#160;");
		} else {
			title.html(this.options.title);
		}
	}
}));
$( "#dialogoEndosos" ).dialog({
	resizable: false,
	modal: true,
	title_html: true,
	autoOpen: false,
	maxWidth: 680,
	width: 680,
	open: function() {
  	$(this).css("maxHeight", 500);
  }
});

$( "#botonAgregarEndoso" ).click(function(){
		$("#dialogoEndosos").html('<div id="progressbar" class="ui-progressbar ui-widget ui-widget-content ui-corner-all progress progress-striped active" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="37"><div class="ui-progressbar-value ui-widget-header ui-corner-left progress-bar progress-bar-success" style="width: 100%;"></div></div>');
	$.ajax({
		url: '/?do=polizas.crearEndoso&idPoliza={idPoliza}',
		success: function(responseText){
			$('#dialogoEndosos').html(responseText);
			$('#dialogoEndosos').dialog('option', 'title', "<div class='widget-header'><h4 class='smaller'><i class='ace-icon fa fa-plus-circle blue'></i> Crear Endoso</h4></div>");
			$('#dialogoEndosos').dialog("open");
		},
		error: function(responseText){
		}
	});
	event.preventDefault();
});

$('.eliminarEndoso').click( function() {
	event.preventDefault();
	$( "#dialog-message-endosos" ).data('link', $(this).attr("x-link")).dialog("open");
});

$( "#dialog-message-endosos" ).dialog({
	resizable: false,
	modal: true,
	title_html: true,
	title: "<div class='widget-header'><h4 class='smaller'><i class='ace-icon fa fa-warning-sign red'></i>¿Desea eliminar el Endoso?</h4></div>",
	autoOpen: false,
	buttons: [
		{
			html: "<i class='ace-icon fa fa-trash bigger-110'></i>&nbsp; Eliminar",
			"class" : "btn btn-danger btn-xs",
			click: function() {
				$.ajax({
					type: "POST",
					dataType: "json",
					url: $(this).data('link'),
					success: function() {
						$("#tabEndosos").html('<div id="progressbar" class="ui-progressbar ui-widget ui-widget-content ui-corner-all progress progress-striped active" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="37"><div class="ui-progressbar-value ui-widget-header ui-corner-left progress-bar progress-bar-success" style="width: 100%;"></div></div>');
						$("#tabEndosos").load('/?do=polizas.verEndosos&idPoliza={idPoliza}');
						actValores();
					}
				});
				$( this ).dialog( "close" );
			}
		}
		,
		{
			html: "<i class='ace-icon fa fa-remove bigger-110'></i>&nbsp;Cancelar",
			"class" : "btn btn-xs",
			click: function() {
				$( this ).dialog( "close" );
			}
		}
	]			
});	

$('.abreLink').click( function() {
	//verVehiculo					
	$('#dialogoEndosos').dialog('option', 'title', "<div class='widget-header'><h4 class='smaller'><i class='ace-icon fa fa-dashboard blue'></i>" + $(this).attr('x-tittle') + "</h4></div>");
	$.ajax({
		url: $(this).attr('x-link'),
		success: function(responseText){
			$('#dialogoEndosos').html(responseText);
			$('#dialogoEndosos').dialog("open");
		},
		error: function(responseText){
		}
	});
	event.preventDefault();
});

				$(".rehabilitaEndoso").on(ace.click_event, function() {
					event.preventDefault();
					var idEndoso = $(this).attr("x-id");
					bootbox.confirm("¿Esta seguro que desea rehabilitar el endoso?", function(result) {
						if(result) {
						$.ajax({
							type: "POST",
							dataType: "json",
							url: '/?do=polizas.anularEndoso&idEndoso=' + idEndoso,
							success: function() {
								$("#tabEndosos").html('<div id="progressbar" class="ui-progressbar ui-widget ui-widget-content ui-corner-all progress progress-striped active" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="37"><div class="ui-progressbar-value ui-widget-header ui-corner-left progress-bar progress-bar-success" style="width: 100%;"></div></div>');
								$("#tabEndosos").load('/?do=polizas.verEndosos&idPoliza={idPoliza}');
								actValores();
							}
						});
						}
					});
				});
				
				$(".anulaEndoso").on(ace.click_event, function() {
					event.preventDefault();
					var idEndoso = $(this).attr("x-id");
					bootbox.prompt("Ingrese el motivo de la anulación del endoso ", function(result) {
						if (result === null) {
							
						} else {
							$.ajax({
								type: "POST",
								dataType: "json",
								url: '/?do=polizas.anularEndoso&idEndoso=' + idEndoso + '&motivo=' + result,
								success: function() {
									$("#tabEndosos").html('<div id="progressbar" class="ui-progressbar ui-widget ui-widget-content ui-corner-all progress progress-striped active" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="37"><div class="ui-progressbar-value ui-widget-header ui-corner-left progress-bar progress-bar-success" style="width: 100%;"></div></div>');
									$("#tabEndosos").load('/?do=polizas.verEndosos&idPoliza={idPoliza}');
									actValores();
								}
							});
						}
					});
				});
				
				$(document).on('click','.eliminarPDFendoso', function(e){
					e.preventDefault();
					var temp = $(this).attr("x-id");
					$( "#dialog-eliminarPDFendoso" ).removeClass('hide').dialog({
						resizable: false,
						width: '320',
						modal: true,
						title: "<div class='widget-header'><h4 class='smaller'><i class='ace-icon fa fa-exclamation-triangle red'></i> ¿Eliminar el archivo guardado?</h4></div>",
						title_html: true,
						buttons: [
							{
								html: "<i class='ace-icon fa fa-trash-o bigger-110'></i>&nbsp; Eliminar",
								"class" : "btn btn-danger btn-minier",
								click: function() {
									$.getJSON("?do=polizas.eliminarPDFendoso&idEndoso="+temp, function( data ) {
										console.log(data)
									});						
									$(".ui-dialog-content").dialog("close");
									$("#tabEndosos").html('<div id="progressbar" class="ui-progressbar ui-widget ui-widget-content ui-corner-all progress progress-striped active" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="37"><div class="ui-progressbar-value ui-widget-header ui-corner-left progress-bar progress-bar-success" style="width: 100%;"></div></div>');
									$("#tabEndosos").load('/?do=polizas.verEndosos&idPoliza={idPoliza}');
								}
							},
							{
								html: "<i class='ace-icon fa fa-times bigger-110'></i>&nbsp; Cancelar",
								"class" : "btn btn-minier",
								click: function() {
									$( this ).dialog( "close" );
								}
							}
						]
					});
					return;
				})
</script>