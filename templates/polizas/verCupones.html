<div id="dialogoCupones">
</div>
<h3 class="header smaller lighter blue" style="margin-top:0px;">Cupones
	<div class="btn-group pull-right">
		<button data-toggle="dropdown" class="btn btn-xs btn-primary dropdown-toggle" aria-expanded="false">
			<i class="ace-icon fa fa-plus-circle bigger-120"></i>&nbsp;&nbsp;Agregar
			<span class="ace-icon fa fa-caret-down icon-on-right"></span>
		</button>
		<ul class="dropdown-menu dropdown-default">
			<li>
				<a id="botonAgregarCupon" href="#">Un Cupon</a>
			</li>
			<li>
				<a id="botonAgregarVariosCupones" href="#">Varios Cupones</a>
			</li>
	
		</ul>
	</div>
</h3>
<div class="table-responsive">
	<table id="sample-table-2" class="table table-striped table-bordered table-hover">
		<thead>
			<tr>
				<th align="center">No.</th>
				<th align="center">Numero de Cupon</th>
				<th align="center">Fecha Vencimiento</th>
				<th align="center">Monto</th>
				<th align="center">Detalles</th>
			</tr>
		</thead>
		<tbody>
			<loop start="cupones"/>
			<tr>
				<td align="center"> {cupones.idLista} </td>
				<td align="center">{cupones.numeroCupon}</td>
				<td style="text-align:center;">{cupones.fechaVencimiento} </td>
				<td style="text-align:center;">{cupones.monto} </td>
				<td style="text-align:center;">
					<div class="action-buttons">
						<a class="blue abreLink" x-tittle="Editar Cupon" x-link="?do=polizas.agregarCupon&idCupon={cupones.idCupon}&idPoliza={idPoliza}" href="#"> <i class="ace-icon fa fa-edit bigger-130"></i> </a>
						<a class="blue eliminarCupon" x-link="?do=polizas.eliminarCuponAjax&idCupon={cupones.idCupon}" href="#" {cupones.verEliminar}> <i class="ace-icon fa fa-trash bigger-130"></i> </a>
					</div>					
				</td>
			</tr>
			<loop end="cupones"/>
		</tbody>
		<tfoot>
			<tr>
				<td align="center" colspan="3"><b>Total</b></td>
				<td align="center"><b>{sumaCupones}</b></td>
				<td>&nbsp;</td>
			</tr>
		</tfoot>
	</table>
	<block start="iguales"/>
		<p align="center">
			<i class="fa fa-check-circle green bigger-110"></i>
			<span>El monto de los cupones concuerda con el total de factura de la poliza.</span>
		</p>
	<block end="iguales"/>
	<block start="mayor"/>
		<p align="center">
			<i class="fa fa-exclamation-triangle orange bigger-110"></i>
			<span>El monto de los cupones es mayor al total de factura de la poliza. <b>{totalFactura}</b></span>
		</p>
	<block end="mayor"/>
	<block start="menor"/>
		<p align="center">
			<i class="fa fa-exclamation-triangle orange bigger-110"></i>
			<span>El monto de los cupones es menor al total de factura de la poliza. <b>{totalFactura}</b></span>
		</p>
	<block end="menor"/>
	<block start="bloqueNoResultados"/>
	<p> No se encontraron cupones en la Poliza. </p>
	<block end="bloqueNoResultados"/>
  <div id="dialog-message-cupones">
    <div class="alert alert-info bigger-110">
      El cupon se eliminara permanentemente, no sera posible recuperarlo.
    </div>
    <div class="space-6">
    </div>
    <p class="bigger-110 bolder center grey"> <i class="ace-icon fa fa-hand-right blue bigger-120"></i> ¿Esta seguro? </p>
  </div>	
</div>
<script type="text/javascript">
$.widget("ui.dialog", $.extend({}, $.ui.dialog.prototype, {
	_title: function(title) {
		if (!this.options.title ) {
			title.html("&#160;");
		} else {
			title.html(this.options.title);
		}
	}
}));
$( "#dialogoCupones" ).dialog({
	resizable: false,
	modal: true,
	title_html: true,
	autoOpen: false,
	maxWidth: 680,
	width: 680,
	open: function() {
  	$(this).css("maxHeight", 600);
  }
});
$( "#botonAgregarCupon" ).click(function(event){
	event.preventDefault();
	$("#dialogoCupones").html('<div id="progressbar" class="ui-progressbar ui-widget ui-widget-content ui-corner-all progress progress-striped active" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="37"><div class="ui-progressbar-value ui-widget-header ui-corner-left progress-bar progress-bar-success" style="width: 100%;"></div></div>');
	$.ajax({
		url: '/?do=polizas.agregarCupon&idPoliza={idPoliza}',
		success: function(responseText){
			$('#dialogoCupones').html(responseText);
			$('#dialogoCupones').dialog('option', 'title', "<div class='widget-header'><h4 class='smaller'><i class='ace-icon fa fa-plus-circle blue'></i> Agregar Cupon</h4></div>");
			$('#dialogoCupones').dialog("open");
		},
		error: function(responseText){
		}
	});
	event.preventDefault();
});
$( "#botonAgregarVariosCupones" ).click(function(event){
	event.preventDefault();
	$("#dialogoCupones").html('<div id="progressbar" class="ui-progressbar ui-widget ui-widget-content ui-corner-all progress progress-striped active" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="37"><div class="ui-progressbar-value ui-widget-header ui-corner-left progress-bar progress-bar-success" style="width: 100%;"></div></div>');
	$.ajax({
		url: '/?do=polizas.agregarVariosCupones&idPoliza={idPoliza}',
		success: function(responseText){
			$('#dialogoCupones').html(responseText);
			$('#dialogoCupones').dialog('option', 'title', "<div class='widget-header'><h4 class='smaller'><i class='ace-icon fa fa-plus-circle blue'></i> Agregar Cupon</h4></div>");
			$('#dialogoCupones').dialog("open");
		},
		error: function(responseText){
		}
	});
	event.preventDefault();
});
$('.eliminarCupon').click( function() {
	event.preventDefault();
	$( "#dialog-message-cupones" ).data('link', $(this).attr("x-link")).dialog("open");
});

$( "#dialog-message-cupones" ).dialog({
	resizable: false,
	modal: true,
	title_html: true,
	title: "<div class='widget-header'><h4 class='smaller'><i class='ace-icon fa fa-warning-sign red'></i>¿Desea eliminar el Cupon?</h4></div>",
	autoOpen: false,
	buttons: [
		{
			html: "<i class='ace-icon fa fa-trash bigger-110'></i>&nbsp; Eliminar",
			"class" : "btn btn-danger btn-xs",
			click: function() {
				$.ajax({
					type: "POST",
					dataType: "json",
					url: $(this).data('link'),
					success: function() {
						$("#tabCupones").html('<div id="progressbar" class="ui-progressbar ui-widget ui-widget-content ui-corner-all progress progress-striped active" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="37"><div class="ui-progressbar-value ui-widget-header ui-corner-left progress-bar progress-bar-success" style="width: 100%;"></div></div>');
						$("#tabCupones").load('/?do=polizas.verCupones&idPoliza={idPoliza}');
						actValores();
					}
				});
				$( this ).dialog( "close" );
			}
		}
		,
		{
			html: "<i class='ace-icon fa fa-remove bigger-110'></i>&nbsp;Cancelar",
			"class" : "btn btn-xs",
			click: function() {
				$( this ).dialog( "close" );
			}
		}
	]			
});	
$('.abreLink').click( function() {
	//verVehiculo					
	$('#dialogoCupones').dialog('option', 'title', "<div class='widget-header'><h4 class='smaller'><i class='ace-icon fa fa-dashboard blue'></i>" + $(this).attr('x-tittle') + "</h4></div>");
	$.ajax({
		url: $(this).attr('x-link'),
		success: function(responseText){
			$('#dialogoCupones').html(responseText);
			$('#dialogoCupones').dialog("open");
		},
		error: function(responseText){
		}
	});
	event.preventDefault();
});
$('body').on('focus',".date-picker", function(){
    $(this).mask("99/99/9999");
	$(this).datepicker({autoclose:true}).next().on(ace.click_event, function(){
		$(this).prev().focus();
	});	
});

</script>