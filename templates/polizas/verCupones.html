<div class="table-responsive">
	<table id="sample-table-2" class="table table-striped table-bordered table-hover">
		<thead>
			<tr>
				<th align="center">No.</th>
				<th align="center">Numero de Cupon</th>
				<th align="center">Monto</th>
				<th align="center">Fecha Vencimiento</th>
				<th colspan="2" align="center">Detalles</th>
			</tr>
		</thead>
		<tbody>
			<loop start="cupones"/>
			<tr>
				<td align="center"> {cupones.idLista} </td>
				<td align="center">{cupones.numeroCupon}</td>
				<td style="text-align:center;">{cupones.monto} </td>
				<td style="text-align:center;">{cupones.fechaVencimiento} </td>
				<td style="text-align:center;"><a id="abrir_{cupones.idLista}" style="cursor:pointer"><img src="../images/icons/Edit.png" /></a></td>
				<td style="text-align:center;"><a href="?do=polizas.eliminarCupon&idCupon={cupones.idCupon}"><img src="../images/icons/Close.png" /></a></td>
			</tr>
			<tr style="background-color:#FFF" id="editar_{cupones.idLista}">
				<td colspan="6"><div style="width:90%">
						<div class="widget-box">
							<div class="widget-header">
								<h4>Editar Cupon</h4>
							</div>
							<div class="widget-body">
								<div class="widget-main no-padding">
									<form class="form-horizontal"  role="form" method="POST" action="?do=polizas.procesarCupones" >
										<fieldset>
											<div class="form-group">
												<label for="vencimiento_{cupones.idCupon}" class="col-sm-3 control-label no-padding-right"> Fecha de Vencimiento </label>
												<div class="col-sm-9">
													<input name="vencimiento_{cupones.idCupon}" type="text" data-date-format="dd/mm/yyyy" readonly="readonly" class="date-picker col-sm-11" id="vencimiento_{cupones.idCupon}" value="{cupones.fechaVencimiento}">
													<span class="input-group-addon"> <i class="icon-calendar"></i> </span> </div>
											</div>
											<div class="form-group">
												<label for="numeroCupon_{cupones.idCupon}" class="col-sm-3 control-label no-padding-right"> Numero de Cupon </label>
												<div class="col-sm-9">
													<input name="numeroCupon_{cupones.idCupon}" type="text" class="col-sm-12" id="numeroCupon_{cupones.idCupon}" value="{cupones.numeroCupon}">
												</div>
											</div>
											<div class="form-group">
												<label for="monto_{cupones.idCupon}" class="col-sm-3 control-label no-padding-right"> Monto </label>
												<div class="col-sm-9">
													<input name="monto_{cupones.idCupon}" type="text" class="col-sm-12" id="monto_{cupones.idCupon}" value="{cupones.monto}">
												</div>
											</div>
											<input name="idPoliza" type="hidden" id="idPoliza" value="{idPoliza}">
											<input name="idCupon" type="hidden" id="idCupon" value="{cupones.idCupon}">
										</fieldset>
										<div class="form-actions center">
											<button class="btn btn-sm btn-success" type="button" onClick="submit();">
												Agregar <i class="icon-arrow-right icon-on-right bigger-110"></i>
											</button>
										</div>
									</form>
								</div>
							</div>
						</div>
					</div></td>
			</tr>
			<loop end="cupones"/>
		</tbody>
	</table>
	<block start="bloqueNoResultados"/>
	<p> No se encontraron cupones en la Poliza. </p>
	<block end="bloqueNoResultados"/>
</div>
<hr />
<div class="center">
	<button class="btn btn-xs btn-primary" id="botonAgregar">
		<i class="icon-comment bigger-120"></i>Agregar Nuevo Cupon
	</button>
	<button class="btn btn-xs btn-info" id="botonAgregarVarios">
		<i class="icon-comments bigger-120"></i>Agregar Varios Cupones
	</button>
</div>
<hr />
<script type="text/javascript">
		jQuery("#agregarCupon").hide();
		jQuery("#agregarVariosCupon").hide();
		<loop start="cupones"/>
		jQuery("#editar_{cupones.idLista}").hide();
		jQuery('#abrir_{cupones.idLista}').click( function() {
			jQuery("#editar_{cupones.idLista}").toggle("slow");
			jQuery("#agregarCupon").hide("slow");
			jQuery("#agregarVariosCupon").hide("slow");
		});		
		<loop end="cupones"/>
		jQuery('#botonAgregar').click( function() {
			jQuery("#agregarCupon").toggle("slow");
			jQuery("#agregarVariosCupon").hide("slow");
			<loop start="cupones"/>
			jQuery("#editar_{cupones.idLista}").hide("slow");
			<loop end="cupones"/>
		});	
		jQuery('#botonAgregarVarios').click( function() {
			jQuery("#agregarVariosCupon").toggle("slow");
			jQuery("#agregarCupon").hide("slow");
			<loop start="cupones"/>
			jQuery("#editar_{cupones.idLista}").hide("slow");
			<loop end="cupones"/>
		});	
		jQuery('#agregarCupones').click( function() {
			var i = parseInt(jQuery('#numCupones').val(),10);
			var primerCupon = parseInt(jQuery('#primerCupon').val(),10);
			
			var mystr = jQuery('#primerVencimiento').val();
			var myarr = mystr.split("/");
			var d = new Date(myarr[2], myarr[1]-1, myarr[0]); 
			var curr_date = ("0" + d.getDate()).slice(-2);
			var curr_month = ("0" + (d.getMonth() + 1)).slice(-2); //Months are zero based
			var curr_year = d.getFullYear();
			
			
			var temp;
			while(i>0){
				temp = curr_date + "/" + curr_month + "/" + curr_year;
				jQuery('#correlativo').val(parseInt(jQuery('#correlativo').val(),10) + 1);
				jQuery('#tablaAgregaCupones').append('<tr><td style="text-align:center"><input name="numeroCupon[]" type="text" class="validate[\'required\']" id="numeroCupon[]" value="' + primerCupon++ + '"/></td><td style="text-align:center"><input name="monto[]" type="text" id="monto[]" value="' + jQuery('#montoC').val() + '"/></td><td style="text-align:center"><input name="vencimiento[]" type="text" id="vencimiento[]" class="fecha" value="' + temp + '"/></td><td style="text-align:center"><img class="eliminaFila" src="../images/icons/Close.png" /></td>');
				jQuery('#cupones').val(parseInt(jQuery('#cupones').val(),10) + 1);
				jQuery(".fecha").mask("99/99/9999");
				d.setMonth( d.getMonth() + 1 );
				curr_date = ("0" + d.getDate()).slice(-2);
				curr_month = ("0" + (d.getMonth() + 1)).slice(-2); //Months are zero based
				curr_year = d.getFullYear();
				i--;
			}
		});
		jQuery("#tablaAgregaCupones").on('click', 'img', function() {
			if(parseInt(jQuery('#cupones').val(),10)!=1){
				var parent = jQuery(this).parents().parents().get(0);
				jQuery(parent).remove();
				jQuery('#cupones').val(parseInt(jQuery('#cupones').val(),10) - 1);
			}
		});		
			jQuery('.date-picker').datepicker({autoclose:true}).next().on(ace.click_event, function(){
					$(this).prev().focus();
				});
		
			

</script>
<div class="widget-box" id="agregarCupon">
	<div class="widget-header">
		<h4>Agregar Nuevo Cupon</h4>
	</div>
	<div class="widget-body">
		<div class="widget-main no-padding">
			<form class="form-horizontal"  role="form" method="POST" action="?do=polizas.procesarCupones" >
				<fieldset>
					<div class="form-group">
						<label for="vencimiento" class="col-sm-3 control-label no-padding-right"> Fecha de Vencimiento </label>
						<div class="col-sm-9">
							<input type="text" name="vencimiento" data-date-format="dd/mm/yyyy" readonly="readonly" class="date-picker col-sm-11 col-xs-10" id="vencimiento">
							<span class="input-group-addon"> <i class="icon-calendar"></i> </span> </div>
					</div>
					<div class="form-group">
						<label for="numeroCupon" class="col-sm-3 control-label no-padding-right"> Numero de Cupon </label>
						<div class="col-sm-9">
							<input name="numeroCupon" type="text" class="col-sm-12 col-xs-12" id="numeroCupon">
						</div>
					</div>
					<div class="form-group">
						<label for="monto" class="col-sm-3 control-label no-padding-right"> Monto </label>
						<div class="col-sm-9">
							<input name="monto" type="text" class="col-sm-12 col-xs-12" id="monto">
						</div>
					</div>
					<input name="idPoliza" type="hidden" id="idPoliza" value="{idPoliza}">
				</fieldset>
				<div class="form-actions center">
					<button class="btn btn-sm btn-success" type="button" onClick="submit();">
						Agregar <i class="icon-arrow-right icon-on-right bigger-110"></i>
					</button>
				</div>
			</form>
		</div>
	</div>
</div>
<div class="widget-box" id="agregarVariosCupon">
	<div class="widget-header">
		<h4>Agregar Varios Cupones</h4>
	</div>
	<div class="widget-body">
		<div class="widget-main no-padding">
			<form class="form-horizontal"  role="form" method="POST" action="?do=polizas.procesarVariosCupones" >
				<fieldset>
					<div class="form-group">
						<label for="primerCupon" class="col-sm-3 control-label no-padding-right"> Primer Cupon </label>
						<div class="col-sm-9">
							<input name="primerCupon" type="text" class="col-sm-12 col-xs-12" id="primerCupon">
						</div>
					</div>
					<div class="form-group">
						<label for="primerVencimiento" class="col-sm-3 control-label no-padding-right"> Primer Vencimiento </label>
						<div class="col-sm-9">
							<input type="text" name="primerVencimiento" data-date-format="dd/mm/yyyy" readonly="readonly" class="date-picker col-sm-11 col-xs-10" id="primerVencimiento">
							<span class="input-group-addon"> <i class="icon-calendar"></i> </span> </div>
					</div>
					<div class="form-group">
						<label for="montoC" class="col-sm-3 control-label no-padding-right"> Monto </label>
						<div class="col-sm-9">
							<input name="montoC" type="text" class="col-sm-12 col-xs-12" id="montoC"  value="0">
						</div>
					</div>
					<div class="form-group">
						<label for="numCupones" class="col-sm-3 control-label no-padding-right"> Numero de Cupones </label>
						<div class="col-sm-9">
							<input name="numCupones" type="text" class="col-sm-12 col-xs-12" id="numCupones"  value="0">
						</div>
					</div>
					<input name="idPoliza" type="hidden" id="idPoliza" value="{idPoliza}">
					<div class="center">
						<button id="agregarCupones" type="button" class="btn btn-xs btn-info">
							<i class="icon-comment icon-on-right bigger-110"></i> Agregar Cupones
						</button>
					</div>
				</fieldset>
					<hr />
					<div class="table-responsive">
						<table id="tablaAgregaCupones" class="table table-striped table-bordered table-hover">
							<tr>
								<td align="center">Numero de Cupon</td>
								<td align="center">Monto</td>
								<td align="center">Fecha Vencimiento</td>
								<td align="center">Eliminar</td>
							</tr>
						</table>
					</div>
					<input name="cupones" type="hidden" id="cupones" value="0">
					<input name="correlativo" type="hidden" id="correlativo" value="0">
					<input name="idPoliza" type="hidden" id="idPoliza" value="{idPoliza}">
					<br />
				<div class="form-actions center">
					<button class="btn btn-sm btn-success" type="button" onClick="submit();">
						Enviar <i class="icon-arrow-right icon-on-right bigger-110"></i>
					</button>
				</div>
			</form>
		</div>
	</div>
</div>
